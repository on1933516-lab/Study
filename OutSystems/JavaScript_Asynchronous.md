# JavaScript ノードにおける非同期処理と `$resolve()` / `$reject()`

OutSystems では、JavaScript の非同期処理（Promise / callback など）がそのまま使用される場合、  
アクションフローが同期的に進行しない問題が発生することがある。

この問題に対応するため、OutSystems では次の 2 つの特殊関数が提供される。

- `$resolve()`
- `$reject()`

これらの関数をコールバック内で使用することで、  
JavaScript ノードが非同期メカニズムを利用している場合でも、  
アクションフローが同期的に実行されるようになる。

OutSystems は `$resolve()` または `$reject()` が呼び出されるまで（ブロックせずに）待機し、  
完了後に次のノードの実行が許可される。  
これにより、JavaScript ノードの出力には処理完了後の適切な値が必ず含まれるようになる。

---

## `$resolve()` — 成功時に使用されるコールバック

- 非同期処理が正常に完了したことを通知するために使用される。
- `$resolve()` はパラメータを持たないため、  
  呼び出し前に必要な値を JavaScript ノードの出力パラメータへ割り当てておく必要がある。
- `$resolve()` が呼び出されると JavaScript ノードが完了となり、  
  アクションフローが同期実行に戻る。

多くの非同期処理は結果値を返す必要があるため、  
出力パラメータへの割り当てが事前に行われることが一般的である。

---

## `$reject()` — エラー発生時に使用されるコールバック

- 予期しないエラーが発生した場合に使用される。
- 任意で JavaScript の Error オブジェクトを受け取り、  
  OutSystems の例外へ変換される。
- `$resolve()` / `$reject()` を使用するアクションは  
  非同期アクションとして扱われるようになる。

---

## 非同期アクションとして扱われるケース

以下のアクションは、OutSystems において非同期アクションとして扱われる。

- JavaScript ノード内で `$resolve()` または `$reject()` が使用されるアクション
- クライアントアクション内でサーバーアクションが呼び出される場合  
  （内部的に非同期 REST 呼び出しへ変換されるため）

非同期アクションは **Function としてマークすることができず**、  
Function としてマークされた他のアクションから呼び出すこともできなくなる。

---
