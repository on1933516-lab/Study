# ■ 画面のライフサイクル（OutSystems）

OutSystems の画面は、**一度ですべてが完成するわけではなく**、  
データ取得の進行に応じて **複数回描画される** という特徴がある。

---

## ① 画面へのアクセス（Access）
- ユーザーが URL にアクセス、またはリンクをクリックする
- 画面ライフサイクルが開始される

---

## ② 画面の初期化（Initialize）
- 画面が生成される
- 入力パラメータやローカル変数が初期化される
- この時点では、まだデータは取得されていない

---

## ③ データ取得処理の開始（Fetch Data）
- 画面に定義されている以下の処理が自動的に開始される  
  - Aggregate（画面表示時に自動・非同期で実行される、画面専用のデータ取得処理）
  - データ取得アクション
- **デフォルトでは非同期かつ並列実行**
  - 複数の Aggregate がある場合、同時に実行される

---

## ④ 初回描画（First Render）
- データ取得の完了を待たずに、描画可能な部分から画面が描画される
- 画面のレイアウト、固定テキスト、一部のウィジェットが表示される
- ユーザーには「画面が先に表示され、後から内容が埋まる」ように見える

---

## ⑤ データ取得完了 → 再描画（Re-render）
- 最初の Aggregate またはデータ取得アクションが完了
- 取得したデータを反映するため、画面が再描画される
- データ取得アクションの場合も同様の挙動となる

---

## ⑥ 残りのデータ取得完了 → 再描画の繰り返し
- 2つ目、3つ目の Aggregate が完了するたびに再描画される
- 新たに取得されたデータを表示するため、画面が更新される
- 最終的に、すべてのデータが揃った状態の画面になる

---

## ■ まとめ
- Aggregate / データ取得アクションは **非同期・並列実行**
- 画面は **初回描画 + データ取得完了ごとの再描画** を行う
- 画面が一瞬空表示になったり、チラつくことがあるのはこの挙動が理由

# ■ 画面イベント（Screen Events）
画面イベントは、画面のライフサイクルの各タイミングで実行される処理。
```text
On Initialize
   ↓
（データ取得）
   ↓
On After Fetch（※データ取得ごと）
   ↓
（初回描画）
   ↓
On Ready
   ↓
On Render（※何度も）
   ↓
On Destroy
```

| イベント | 実行タイミング | 実行回数 | 主な用途 | 注意点 |
|---|---|---|---|---|
| **On Initialize** | ・DOMの読み込み開始前<br>・Aggregate / Data Action の実行開始と同時 | 1回 | ・入力パラメータの検証<br>・画面ローカル変数の初期化<br>・初期表示用の状態設定 | ・DOM操作は不可<br>・JavaScriptで要素を触らない |
| **On After Fetch** | ・Aggregate / Data Action の<br>データ取得完了直後 | 複数回<br>（取得ごと） | ・取得データの加工<br>・集計や計算処理<br>・ウィジェット用データの整形 | ・重い処理は避ける<br>・不要なサーバーリクエストに注意 |
| **On Ready** | ・DOMがすべて読み込まれた後 | 1回 | ・DOM要素の操作<br>・JavaScriptコールバック登録<br>・JavaScriptライブラリ初期化<br>・アナリティクス計測開始 | ・初回のみ実行される |
| **On Render** | ・画面の一部が描画されるたび<br>・初回描画を含む | 複数回 | ・描画後のUI調整<br>・ウィジェット依存関係の再構成<br>・描画時のイベントハンドラ設定 | ・頻繁に呼ばれるため重い処理は避ける |
| **On Destroy** | ・ユーザーが別画面へ遷移するとき | 1回 | ・DOMのリセット<br>・JavaScriptコールバック解除<br>・ライブラリのクリーンアップ<br>・滞在時間などの送信 | ・後処理専用 |

